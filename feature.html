<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>APX ULTRA V16</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@600&display=swap" rel="stylesheet">

<style>
:root{
 --neon:#00fff2;
 --bg:#050b14;
 --panel:#0f172a;
 --call:#00ff88;
 --put:#ff2e63;
}
body{background:var(--bg);color:white;font-family:'Rajdhani';margin:0}
header{
 text-align:center;
 padding:15px;
 font-family:'Orbitron';
 color:var(--neon);
 border-bottom:2px solid var(--neon);
 box-shadow:0 0 20px var(--neon);
}
.container{max-width:520px;margin:auto;padding:15px}
.panel{
 background:var(--panel);
 border-radius:18px;
 padding:20px;
 border:1px solid rgba(0,255,242,0.3);
 box-shadow:0 0 25px rgba(0,255,242,0.2);
}
.tabs{display:flex;gap:6px;margin-bottom:12px}
.tab{
 flex:1;
 padding:10px;
 border-radius:8px;
 border:1px solid var(--neon);
 background:transparent;
 color:var(--neon);
 cursor:pointer;
 font-weight:bold;
}
.tab.active{
 background:var(--neon);
 color:black;
}
select,input{
 width:100%;
 padding:12px;
 margin-bottom:10px;
 border-radius:10px;
 border:1px solid #334155;
 background:#0b1220;
 color:white;
}
button{
 width:100%;
 padding:14px;
 margin-bottom:10px;
 border-radius:12px;
 border:none;
 font-family:'Orbitron';
 font-weight:bold;
 cursor:pointer;
}
.main-btn{
 background:var(--neon);
 color:black;
 box-shadow:0 0 15px var(--neon);
}
.tg-btn{
 background:#0088cc;
 color:white;
 box-shadow:0 0 15px #0088cc;
}
#output{
 margin-top:15px;
 white-space:pre;
 font-family:monospace;
 font-size:13px;
 border:1px dashed var(--neon);
 padding:15px;
 border-radius:12px;
}
</style>
</head>
<body>

<header>APX ULTRA V16</header>

<div class="container">
<div class="panel">

<div class="tabs">
<button class="tab active" onclick="setMarket('OTC',this)">OTC</button>
<button class="tab" onclick="setMarket('STOCK',this)">STOCK</button>
<button class="tab" onclick="setMarket('CRYPTO',this)">CRYPTO</button>
</div>

<select id="pairs" multiple size="8"></select>

<div style="display:flex;gap:10px;">
<input type="time" id="start" value="18:00">
<input type="time" id="end" value="20:00">
</div>

Signals Count:
<input type="number" id="count" value="15" min="5" max="20">

<button class="main-btn" onclick="generate()">GENERATE SIGNALS</button>
<button class="tg-btn" onclick="sendTG()">SEND TELEGRAM</button>

<div id="output">READY...</div>

</div>
</div>

<script>

const API = "https://apx.mkapi009.workers.dev?pair=";
const TG  = "https://signal.mkapi009.workers.dev/send";

const MARKETS = {
OTC:[
"USDPKR-otc","USDBDT-otc","USDINR-otc","USDARS-otc",
"USDNGN-otc","BRLUSD-otc","USDMXN-otc",
"USDEGP-otc","USDIDR-otc"
],
STOCK:[
"MSFSTK-OTC","AXPSTK-OTC","PFESTK-OTC",
"MCDSTK-OTC","JNJSTK-OTC","FABSTK-OTC","BOISTK-OTC"
],
CRYPTO:[
"XAUUSD-otc","BTCUSD-otc"
]
};

let FINAL_SIGNALS=[];
let CURRENT_MARKET="OTC";

function setMarket(type,btn){
 CURRENT_MARKET=type;
 document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
 btn.classList.add("active");
 const sel=document.getElementById("pairs");
 sel.innerHTML="";
 MARKETS[type].forEach(p=>{
   let o=document.createElement("option");
   o.value=p;
   o.textContent=p;
   sel.appendChild(o);
 });
}
setMarket("OTC",document.querySelector(".tab"));

/* ===== CORE LOGIC ===== */

function EMA(data,period){
 let k=2/(period+1);
 let ema=data[0].close;
 for(let i=1;i<data.length;i++){
   ema=data[i].close*k+ema*(1-k);
 }
 return ema;
}

function analyze(candles){
 if(candles.length<150) return null;

 let recent=candles.slice(-150);
 let ema20=EMA(recent.slice(-20),20);
 let ema50=EMA(recent.slice(-50),50);

 let momentum=0;
 let last6=recent.slice(-6);

 for(let i=1;i<last6.length;i++){
   if(last6[i].close>last6[i-1].close) momentum++;
   else momentum--;
 }

 if(ema20>ema50 && momentum>=2) return "CALL";
 if(ema20<ema50 && momentum<=-2) return "PUT";

 let last=recent[recent.length-1];
 return last.close>last.open?"CALL":"PUT";
}

/* ===== ENGINE ===== */

async function generate(){

 FINAL_SIGNALS=[];
 const selected=[...document.getElementById("pairs").selectedOptions].map(o=>o.value);
 const count=parseInt(document.getElementById("count").value);
 const start=document.getElementById("start").value;
 const end=document.getElementById("end").value;
 const output=document.getElementById("output");

 if(!selected.length){ alert("Select pairs!"); return; }

 output.innerText="Analyzing market structure...";

 for(const pair of selected){

   try{
     const res=await fetch(API+pair);
     const json=await res.json();
     const candles=json?.data || [];
     const dir=analyze(candles);
     if(!dir) continue;

     distribute(pair,dir,count,start,end);

   }catch(e){console.log(e);}
 }

 FINAL_SIGNALS.sort((a,b)=>a.raw-b.raw);
 display();
}

function distribute(pair,dir,count,start,end){

 const now=new Date();
 let s=new Date(now.toDateString()+" "+start).getTime();
 let e=new Date(now.toDateString()+" "+end).getTime();
 if(e<=s) e+=86400000;

 let gap=(e-s)/count;

 for(let i=0;i<count;i++){
   let t=new Date(s+(gap*i));
   t.setSeconds(0);

   FINAL_SIGNALS.push({
     pair:pair,
     time:t.toTimeString().slice(0,5),
     raw:t.getTime(),
     dir:dir
   });
 }
}

function display(){

 const out=document.getElementById("output");

 if(!FINAL_SIGNALS.length){
   out.innerText="No valid setups found.";
   return;
 }

 let text="TIME   | PAIR        | DIR\n";
 text+="---------------------------------\n";

 FINAL_SIGNALS.forEach(s=>{
   text+=`${s.time} | ${s.pair.padEnd(11)} | ${s.dir}\n`;
 });

 out.innerText=text;
}

async function sendTG(){

 if(!FINAL_SIGNALS.length){alert("Generate first!");return;}

 let msg="✦══ APX ULTRA SIGNALS ══✦\n\n";
 msg+="UTC+6 | 1 Min Expiry\n\n";
 msg+="```\n";

 FINAL_SIGNALS.forEach(s=>{
   msg+=`${s.time} | ${s.pair.padEnd(11)} | ${s.dir}\n`;
 });

 msg+="```\n";

 await fetch(TG,{method:"POST",body:msg});
 alert("Sent to Telegram!");
}

</script>
</body>
</html>
