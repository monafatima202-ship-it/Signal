<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>APX ULTRA V40 - Highest Accuracy</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">

<style>
:root {
  --bg: #02060c;
  --panel: #0a111f;
  --neon: #00ff88;
  --neon-glow: 0 0 15px #00ff88;
  --text: #e0fbee;
}

body { margin:0; background:var(--bg); color:var(--text); font-family:'Rajdhani'; overflow-x:hidden; }
header { text-align:center; padding:20px; background:black; border-bottom:3px solid var(--neon); box-shadow:var(--neon-glow); }
.logo { font-family:'Orbitron'; font-size:26px; color:var(--neon); text-shadow:0 0 10px var(--neon); letter-spacing:2px; }

.container { max-width:450px; margin:15px auto; padding:10px; }
.panel { background:var(--panel); border-radius:20px; padding:20px; border:1px solid rgba(0,255,136,.2); box-shadow:0 0 40px rgba(0,0,0,0.5); }

.tabs { display:flex; gap:8px; margin-bottom:15px; }
.tab { flex:1; padding:10px; border:1.5px solid var(--neon); background:transparent; color:var(--neon); border-radius:8px; font-weight:bold; cursor:pointer; font-family:'Orbitron'; font-size:11px; transition: 0.3s; }
.tab.active { background:var(--neon); color:black; box-shadow:var(--neon-glow); }

select { width:100%; padding:12px; margin-bottom:15px; background:#050d1a; border:1px solid #1a3a3a; border-radius:10px; color:white; font-size:14px; }
.time-row { display:flex; justify-content:space-between; gap:10px; margin-bottom:15px; }
input[type="time"] { flex:1; padding:12px; background:#050d1a; border:1px solid #1a3a3a; border-radius:10px; color:white; }

button { width:100%; padding:16px; margin-top:10px; border:none; border-radius:12px; font-family:'Orbitron'; font-weight:900; cursor:pointer; text-transform:uppercase; font-size:14px; }
.generate { background:linear-gradient(135deg,#00ff88,#00ccff); color:black; box-shadow:var(--neon-glow); }
.telegram { background:#0088cc; color:white; }

#output { margin-top:20px; background:#01040a; padding:15px; border-radius:12px; border:1px dashed var(--neon); white-space:pre-wrap; font-family:monospace; font-size:12px; color:#afffdf; line-height:1.5; min-height:150px; }
</style>
</head>

<body>

<header><div class="logo">APX ULTRA V40 - Highest Accuracy</div></header>

<div class="container">
  <div class="panel">
    <div class="tabs">
      <button class="tab active" onclick="setMarket('OTC',this)">OTC</button>
      <button class="tab" onclick="setMarket('STOCK',this)">STOCKS</button>
      <button class="tab" onclick="setMarket('CRYPTO',this)">CRYPTO</button>
    </div>

    <label style="font-size:12px; color:var(--neon)">SELECT MULTIPLE ASSETS:</label>
    <select id="pairs" multiple size="6"></select>

    <div class="time-row">
      <div><small>START TIME</small><input type="time" id="start" value="21:00"></div>
      <div><small>END TIME</small><input type="time" id="end" value="23:00"></div>
    </div>

    <button class="generate" onclick="generate()">AI BRAIN ANALYSIS</button>
    <button class="telegram" onclick="sendTG()">SEND TO TELEGRAM</button>

    <div id="output">SYSTEM STATUS: WAITING...</div>
  </div>
</div>

<script>
const API = "https://apx.mkapi009.workers.dev?pair=";
const TG = "https://signal.mkapi009.workers.dev/send";

let FINAL_SIGNALS = [];
let LOCK = false;

const ASSETS = {
  OTC: ["USDPKR-otc","USDBDT-otc","USDINR-otc","USDARS-otc","USDNGN-otc","BRLUSD-otc","USDMXN-otc","USDEGP-otc","USDIDR-otc"],
  STOCK: ["MSFSTK-otc","AXPSTK-OTC","PFESTK-otc","MCDSTK-otc","JNJSTK-otc"],
  CRYPTO: ["XAUUSD-otc","BTCUSD-otc","ETHUSD-otc"]
};

function setMarket(type, btn) {
  document.querySelectorAll(".tab").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
  const select = document.getElementById('pairs');
  select.innerHTML = "";
  ASSETS[type].forEach(p => {
    let opt = document.createElement("option");
    opt.value = p;
    opt.textContent = p.replace(/-otc|-OTC/gi, '').toUpperCase();
    select.appendChild(opt);
  });
}
setMarket("OTC", document.querySelector(".tab.active"));

// --- HIGHEST ACCURACY BRAIN LOGIC ---
function getRSI(data, period = 14) {
  if (data.length < period + 1) return 50;
  let gains = 0, losses = 0;
  for (let i = data.length - period; i < data.length; i++) {
    let diff = data[i].close - data[i-1].close;
    if (diff >= 0) gains += diff; else losses -= diff;
  }
  let avgGain = gains / period;
  let avgLoss = losses / period || 0.0001;
  let rs = avgGain / avgLoss;
  return 100 - (100 / (1 + rs));
}

function analyzeBrain(candles) {
  if (candles.length < 200) return null;

  // EMA Stack for trend strength
  let ema20 = EMA(candles, 20);
  let ema50 = EMA(candles, 50);
  let ema100 = EMA(candles, 100);
  let ema200 = EMA(candles, 200);

  if (!ema20 || !ema50 || !ema100 || !ema200) return null;

  let trendScore = 0;
  if (ema20 > ema50 && ema50 > ema100 && ema100 > ema200) trendScore = 4;   // very strong up
  else if (ema20 < ema50 && ema50 < ema100 && ema100 < ema200) trendScore = -4; // very strong down
  else if (ema20 > ema50 && ema50 > ema100) trendScore = 3;
  else if (ema20 < ema50 && ema50 < ema100) trendScore = -3;
  else if (ema20 > ema50) trendScore = 1;
  else if (ema20 < ema50) trendScore = -1;

  // RSI filter (avoid overbought/oversold extremes)
  let rsi = getRSI(candles);
  let rsiScore = 0;
  if (rsi < 35) rsiScore = 3;    // oversold ‚Üí CALL boost
  if (rsi > 65) rsiScore = -3;   // overbought ‚Üí PUT boost

  // Momentum last 30 candles
  let momentum = 0;
  for (let i = candles.length - 30; i < candles.length; i++) {
    let diff = candles[i].close - candles[i-1].close;
    if (diff > 0) momentum += 1.5;
    if (diff < 0) momentum -= 1.5;
  }

  // Last candle strength
  let last = candles[candles.length - 1];
  let body = Math.abs(last.close - last.open);
  let range = last.high - last.low || 0.0001;
  let strength = body / range;
  let strengthScore = strength > 0.65 ? 2 : 0;

  // Final score
  let totalScore = trendScore + rsiScore + momentum + strengthScore;

  if (totalScore >= 8) return "CALL";
  if (totalScore <= -8) return "PUT";

  return null; // Very strict - only high confidence signals
}

function EMA(data, period) {
  if (data.length < period) return null;
  let k = 2 / (period + 1);
  let ema = data[data.length - period].close;
  for (let i = data.length - period + 1; i < data.length; i++) {
    ema = data[i].close * k + ema * (1 - k);
  }
  return ema;
}

async function generate() {
  if (LOCK) return alert("Already Generated. Refresh to rescan.");
  LOCK = true;
  FINAL_SIGNALS = [];

  const output = document.getElementById('output');
  output.innerHTML = `<div class="loader-box">AI BRAIN READING 500+ CANDLES...<div class="bar-bg"><div class="bar-fill" style="width:0%"></div></div><span id="perc">0%</span></div>`;

  const selected = [...document.getElementById('pairs').selectedOptions].map(o => o.value);
  if (selected.length < 1) {
    output.innerText = "Select at least 1-2 pairs!";
    LOCK = false;
    return;
  }

  let analyzedPool = [];
  for (let i = 0; i < selected.length; i++) {
    try {
      let res = await fetch(API + selected[i]);
      let json = await res.json();
      let decision = analyzeBrain(json.data || []);
      if (decision) {
        analyzedPool.push({ pair: selected[i].replace(/-otc|-OTC/gi, ''), dir: decision });
      }
      let p = ((i + 1) / selected.length) * 100;
      document.querySelector('.bar-fill').style.width = p + "%";
      document.getElementById('perc').innerText = Math.round(p) + "%";
    } catch (e) { console.error(e); }
  }

  if (analyzedPool.length === 0) {
    output.innerText = "MARKET UNSTABLE: NO HIGH CONFIDENCE TRENDS FOUND.";
    LOCK = false;
    return;
  }

  // Professional Time Distribution (5‚Äì10 min gap)
  const sT = document.getElementById('start').value;
  const eT = document.getElementById('end').value;
  let start = new Date("2025-01-01 " + sT).getTime();
  let end = new Date("2025-01-01 " + eT).getTime();
  if (end <= start) end += 86400000;

  let currentPoint = start;
  while (currentPoint < end && FINAL_SIGNALS.length < 12) {
    currentPoint += (5 + Math.random() * 5) * 60000; // 5 to 10 min gap
    if (currentPoint >= end) break;

    let asset = analyzedPool[FINAL_SIGNALS.length % analyzedPool.length];
    FINAL_SIGNALS.push({
      time: new Date(currentPoint).toTimeString().slice(0,5),
      pair: asset.pair,
      dir: asset.dir
    });
  }

  renderResult();
  LOCK = false;
}

function renderResult() {
  let h = "‚úÖ APX ULTRA V40 PRO SIGNALS ‚úÖ\n";
  h += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
  h += "ZONE: GMT+6 | 1 MIN EXP\n\n";
  FINAL_SIGNALS.forEach(s => {
    h += `‚ú¶ ${s.pair.padEnd(10)} ${s.time}   ${s.dir}\n`;
  });
  h += "\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
  h += "BRAIN LOGIC: EMA STACK + RSI + MOMENTUM + STRENGTH\n";
  document.getElementById('output').innerText = h;
}

async function sendTG() {
  if (!FINAL_SIGNALS.length) return alert("Generate first!");
  
  const stages = [
    { m: "INITIATING API SCAN...", b: "üü©‚¨ú‚¨ú‚¨ú‚¨ú 20%" },
    { m: "READING 500+ REAL CANDLES...", b: "üü©üü©‚¨ú‚¨ú‚¨ú 40%" },
    { m: "CALCULATING EMA + RSI + MOMENTUM...", b: "üü©üü©üü©‚¨ú‚¨ú 60%" },
    { m: "FILTERING STRONG SETUPS...", b: "üü©üü©üü©üü©‚¨ú 80%" },
    { m: "HIGH CONFIDENCE SIGNALS READY!", b: "üü©üü©üü©üü©üü© 100%" }
  ];

  try {
    for (let s of stages) {
      await fetch(TG, { method: "POST", body: `[ APX AI STATUS ]\n\( {s.m}\n \){s.b}` });
      await new Promise(r => setTimeout(r, 1500));
    }

    let msg = "üåü APX ULTRA PRO SIGNALS üåü\n";
    msg += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
    msg += "üìÖ " + new Date().toLocaleDateString() + " | GMT+6\n";
    msg += "üí° SYSTEM: BRAIN V40\n";
    msg += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n";
    
    FINAL_SIGNALS.forEach(s => {
      msg += `üí´\( {s.pair.padEnd(10)}‚Ä¢ \){s.time};${s.dir}\n`;
    });

    msg += "\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
    msg += "‚ö†Ô∏è RULES:\n";
    msg += "1. Trade exactly at 00 sec\n";
    msg += "2. 1-Step Martingale Only\n";
    msg += "3. Stop if 2 continuous losses\n";
    msg += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
    msg += "POWERED BY APX PREMIUM AI";

    await fetch(TG, { method: "POST", body: msg });
    alert("Sent Successfully!");
  } catch (e) { alert("Telegram Error!"); }
}
</script>
</body>
</html>
