<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>APX FINAL CLEAN TRIGGER</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">

<style>
:root{
--bg:#02060c;
--panel:#0a111f;
--neon:#00ff88;
--cyan:#00ccff;
}
body{margin:0;background:var(--bg);color:white;font-family:'Rajdhani';}
header{text-align:center;padding:20px;background:black;border-bottom:3px solid var(--neon);}
.logo{font-family:'Orbitron';color:var(--neon);font-size:22px;}
.container{max-width:480px;margin:20px auto;padding:15px;}
.panel{background:var(--panel);border-radius:20px;padding:25px;border:2px solid rgba(0,255,136,.3);}
.tabs{display:flex;gap:10px;margin-bottom:15px;}
.tab{flex:1;padding:10px;border:2px solid var(--neon);background:transparent;color:var(--neon);border-radius:8px;font-family:'Orbitron';cursor:pointer;}
.tab.active{background:linear-gradient(135deg,var(--neon),var(--cyan));color:black;}
select,input{width:100%;padding:12px;margin-bottom:15px;background:#050d1a;border:1px solid #1a3a3a;border-radius:10px;color:white;}
button{width:100%;padding:14px;margin-top:10px;border:none;border-radius:10px;font-family:'Orbitron';font-weight:bold;text-transform:uppercase;}
.generate{background:linear-gradient(135deg,#00ff88,#00ccff);color:black;}
.telegram{background:#0088cc;color:white;}

#output{
margin-top:20px;
background:#01040a;
padding:15px;
border-radius:12px;
border:1px dashed var(--neon);
white-space:pre-wrap;
font-family:monospace;
font-size:13px;
min-height:180px;
}

/* SINGLE LOADER */
.loader-box{text-align:center;padding:15px;}
.bar-bg{width:100%;height:12px;background:#0d1e13;border-radius:12px;overflow:hidden;margin-top:10px;}
.bar-fill{
height:100%;
width:0%;
background:linear-gradient(90deg,#00ff88,#00ccff,#00ff88);
background-size:200% 100%;
animation:move 1.2s linear infinite;
transition:width 0.4s ease;
}
@keyframes move{
0%{background-position:0% 0;}
100%{background-position:200% 0;}
}
.percent{margin-top:6px;font-size:12px;color:#00ff88;}
</style>
</head>

<body>

<header><div class="logo">APX FINAL CLEAN TRIGGER</div></header>

<div class="container">
<div class="panel">

<div class="tabs">
<button class="tab active" onclick="setMarket('OTC',this)">OTC</button>
<button class="tab" onclick="setMarket('STOCK',this)">STOCK</button>
<button class="tab" onclick="setMarket('CRYPTO',this)">CRYPTO</button>
</div>

<select id="pairs" multiple size="6"></select>
<input type="time" id="start" value="21:00">

<button class="generate" onclick="scan()">TRIGGER SCAN</button>
<button class="telegram" onclick="sendTG()">SEND TELEGRAM</button>

<div id="output">SYSTEM READY...</div>

</div>
</div>

<script>
const API="https://apx.mkapi009.workers.dev?pair=";
const TG="https://signal.mkapi009.workers.dev/send";

let FINAL=[];
let RUN=false;

const ASSETS={
OTC:["USDPKR-otc","USDBDT-otc","USDINR-otc","USDARS-otc","USDNGN-otc","BRLUSD-otc","USDMXN-otc","USDEGP-otc","USDIDR-otc"],
STOCK:["MSFSTK-otc","AXPSTK-OTC","PFESTK-otc","MCDSTK-otc","JNJSTK-otc"],
CRYPTO:["XAUUSD-otc","BTCUSD-otc","ETHUSD-otc"]
};

function setMarket(type,btn){
document.querySelectorAll(".tab").forEach(b=>b.classList.remove("active"));
btn.classList.add("active");
let s=document.getElementById("pairs");
s.innerHTML="";
ASSETS[type].forEach(p=>{
let o=document.createElement("option");
o.value=p;
o.textContent=p.replace(/-otc|-OTC/gi,'');
s.appendChild(o);
});
}
setMarket("OTC",document.querySelector(".tab.active"));

function setLoader(percent){
document.getElementById("output").innerHTML=
`<div class="loader-box">
<div class="bar-bg"><div class="bar-fill" style="width:${percent}%"></div></div>
<div class="percent">${percent}%</div>
</div>`;
}

function EMA(data,p){
let k=2/(p+1);
let ema=data[0].close;
for(let i=1;i<data.length;i++){
ema=data[i].close*k+ema*(1-k);
}
return ema;
}

function detect(data,pair){
let res=[];
if(data.length<200)return res;

for(let i=50;i<data.length;i++){
let slice=data.slice(i-50,i);
let ema20=EMA(slice,20);
let ema50=EMA(slice,50);
let last=data[i];

let score=0;
if(ema20>ema50)score++;
if(ema20<ema50)score--;

let momentum=0;
for(let j=i-10;j<i;j++){
let diff=data[j].close-data[j-1].close;
if(diff>0)momentum++;
if(diff<0)momentum--;
}
if(momentum>6)score+=2;
if(momentum<-6)score-=2;

let body=Math.abs(last.close-last.open);
let range=last.high-last.low||0.0001;
if(body/range>0.6)score++;

if(Math.abs(score)>=3){
res.push({
minute:i,
pair:pair,
dir:score>0?"CALL":"PUT",
strength:Math.abs(score)
});
}
}
return res;
}

async function scan(){
if(RUN)return;
RUN=true;
FINAL=[];
setLoader(10);

let selected=[...document.getElementById("pairs").selectedOptions].map(o=>o.value);
let global=[];
let progress=10;

for(let pair of selected){
let res=await fetch(API+pair);
let j=await res.json();
let t=detect(j.data||[],pair.replace(/-otc|-OTC/gi,''));
global=global.concat(t);

progress+=Math.floor(40/selected.length);
setLoader(progress);
}

if(global.length===0){
document.getElementById("output").innerText="NO VALID TRIGGERS.";
RUN=false;
return;
}

let minuteMap={};
global.forEach(t=>{
if(!minuteMap[t.minute]||minuteMap[t.minute].strength<t.strength){
minuteMap[t.minute]=t;
}
});

let clean=Object.values(minuteMap).sort((a,b)=>a.minute-b.minute);

let filtered=[];
for(let i=0;i<clean.length;i++){
if(i===0||clean[i].minute-clean[i-1].minute>1){
filtered.push(clean[i]);
}
}

filtered=filtered.slice(-18);

let start=new Date("2025-01-01 "+document.getElementById("start").value).getTime();
filtered.forEach((t,i)=>{
FINAL.push({
time:new Date(start+(i*60000)).toTimeString().slice(0,5),
pair:t.pair,
dir:t.dir
});
});

setLoader(70);
render();
RUN=false;
}

function render(){
let h="APX FINAL CLEAN TRIGGER\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nUTC+6 | 1 MIN EXP\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n";
FINAL.forEach(s=>{
h+=`${s.pair.padEnd(10)} ${s.time}   ${s.dir}\n`;
});
h+="\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nReal API Candle Logic\n";
document.getElementById("output").innerText=h;
}

async function sendTG(){
if(FINAL.length===0)return alert("Scan first.");

setLoader(85);
await new Promise(r=>setTimeout(r,800));
setLoader(95);
await new Promise(r=>setTimeout(r,800));
setLoader(100);

let msg="üìä APX FINAL CLEAN TRIGGER üìä\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nUTC+6 | 1 MIN EXP\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n```text\n";
FINAL.forEach(s=>{
msg+=`${s.pair.padEnd(10)} ${s.time}   ${s.dir}\n`;
});
msg+="```\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nTrade exact time\n1 Step Martingale\nStop after 2 losses\n\nPowered by APX Premium";

await fetch(TG,{method:"POST",body:msg});
alert("Signals Sent!");
}
</script>
</body>
</html>
