<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>APX ULTRA V12</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@600&display=swap" rel="stylesheet">
<style>
:root { --neon: #00ffea; --dark: #0a0e17; --panel: #111827; --call: #00ff88; --put: #ff3366; }
body { background: var(--dark); color: white; font-family: 'Rajdhani'; margin: 0; }
header { padding: 15px; text-align: center; border-bottom: 2px solid var(--neon); background: #000; box-shadow: 0 0 15px var(--neon); }
.logo { font-family: 'Orbitron'; color: var(--neon); font-size: 20px; letter-spacing: 2px; }
.container { max-width: 480px; margin: 15px auto; padding: 10px; }
.panel { background: var(--panel); border: 1px solid rgba(0,255,234,0.2); border-radius: 16px; padding: 20px; }
.tabs { display: flex; gap: 8px; margin-bottom: 15px; }
.tab { flex: 1; padding: 10px; border: 1px solid var(--neon); background: transparent; color: var(--neon); border-radius: 8px; cursor: pointer; font-size: 12px; }
.tab.active { background: var(--neon); color: #000; font-weight: bold; }
select, input { width: 100%; padding: 12px; background: #0f1624; color: white; border: 1px solid #334155; border-radius: 10px; margin-bottom: 12px; font-family: 'Rajdhani'; }
.main-btn, .tg-btn { width: 100%; padding: 16px; border-radius: 12px; border: none; font-family: 'Orbitron'; font-weight: bold; cursor: pointer; margin-bottom: 10px; transition: 0.3s; }
.main-btn { background: var(--neon); color: #000; }
.tg-btn { background: #0088cc; color: white; }
#output { margin-top: 15px; border: 1px dashed var(--neon); border-radius: 12px; background: rgba(0,255,234,0.03); padding: 15px; font-family: monospace; white-space: pre; color: #00ff88; font-size: 12px; }
</style>
</head>
<body>

<header>
    <div class="logo">APX ULTRA V12</div>
    <div id="clock" style="color:#ffd700; font-size:12px; margin-top:5px;">UTC+6</div>
</header>

<div class="container">
    <div class="panel">
        <div class="tabs">
            <button class="tab active" onclick="setMarket('OTC',this)">OTC</button>
            <button class="tab" onclick="setMarket('STOCK',this)">STOCK</button>
            <button class="tab" onclick="setMarket('CRYPTO',this)">CRYPTO</button>
        </div>
        <select id="pairs" multiple style="height:120px;"></select>
        <div style="display:flex; gap:10px;">
            <input type="time" id="start" value="18:00">
            <input type="time" id="end" value="20:00">
        </div>
        <button class="main-btn" onclick="startEngine()">GENERATE 15+ SIGNALS</button>
        <button class="tg-btn" onclick="pushTG()">SEND TO TELEGRAM</button>
        <div id="output">SYSTEM READY...</div>
    </div>
</div>

<script>
const API = "https://apx.mkapi009.workers.dev?pair=";
const TG  = "https://signal.mkapi009.workers.dev/send";
let SIGNALS = [];

const LIST = {
    OTC: ["USDINR-otc","USDPKR-otc","USDBDT-otc","USDCOP-otc","USDARS-otc","USDMXN-otc","USDBRL-otc"],
    STOCK: ["MSFSTK-OTC","AXPSTK-OTC","AAPL-OTC"],
    CRYPTO: ["BTCUSD-otc","ETHUSD-otc"]
};

setInterval(() => {
    let d = new Date();
    d.setHours(d.getUTCHours() + 6);
    document.getElementById('clock').innerText = "UTC+6 | " + d.toLocaleTimeString('en-GB');
}, 1000);

function setMarket(t, btn){
    document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const sel = document.getElementById('pairs');
    sel.innerHTML = '';
    LIST[t].forEach(p => {
        let opt = document.createElement('option');
        opt.value = p; opt.textContent = p.toUpperCase().replace('-OTC','');
        sel.appendChild(opt);
    });
}
setMarket('OTC', document.querySelector('.tab'));

async function startEngine() {
    SIGNALS = [];
    const selected = [...document.getElementById('pairs').selectedOptions].map(o => o.value);
    if (!selected.length) return alert("Bhai, pairs select karo!");

    document.getElementById('output').innerHTML = "ANALYZING TRENDS...";

    for (const pair of selected) {
        try {
            const res = await fetch(API + pair);
            const json = await res.json();
            const candles = json?.data || [];
            
            // Brain Logic: Momentum check
            let score = 0;
            candles.slice(-20).forEach((c, i, arr) => {
                if(i > 0) score += (c.close > arr[i-1].close ? 1 : -1);
            });

            // Generate 8 signals per pair (Total volume high karne ke liye)
            distribute(pair, score >= 0 ? "CALL" : "PUT");
        } catch(e) { console.error(e); }
    }
    SIGNALS.sort((a,b) => a.raw - b.raw);
    display();
}

function distribute(pair, dir) {
    const s = document.getElementById('start').value;
    const e = document.getElementById('end').value;
    const now = new Date();
    let sD = new Date(now.toDateString() + " " + s).getTime();
    let eD = new Date(now.toDateString() + " " + e).getTime();
    if (eD <= sD) eD += 86400000;

    const count = 8; // Per pair signals
    const step = (eD - sD) / (count + 1);

    for (let i = 1; i <= count; i++) {
        let t = new Date(sD + (step * i));
        t.setSeconds(0);
        SIGNALS.push({
            pair: pair.toUpperCase().replace('-OTC','').replace('-otc',''),
            time: t.toTimeString().slice(0,5),
            raw: t.getTime(),
            dir: dir
        });
    }
}

function display() {
    const out = document.getElementById('output');
    out.innerHTML = SIGNALS.map(s => `[${s.time}] ${s.pair.padEnd(8)} | ${s.dir}`).join('\n');
}

async function pushTG() {
    if (!SIGNALS.length) return alert("Pehle signals generate karein");

    // Exact Alignment Header
    let msg = `✦═╡ APX ULTRA SIGNALS ╞═✦\n\n`;
    msg += `UTC+6 Timezone | 1 Min Expiry\n`;
    msg += `━━━━━━━━━━━━━━━━━━━━\n`;

    SIGNALS.forEach(s => {
        // MONOSPACE ALIGNMENT LOGIC
        // Time is 5 chars, Pair is padded to 8 chars, Dir is fixed
        let timeStr = `✦ ${s.time}`;
        let pairStr = `${s.pair}`.padEnd(8);
        msg += `${timeStr} | ${pairStr} | ${s.dir}\n`;
    });

    msg += `━━━━━━━━━━━━━━━━━━━━\n`;
    msg += `RULES: 1-Step Martingale | Avoid News\n`;
    msg += `Powered by APX Premium`;

    try {
        await fetch(TG, { method: "POST", body: msg });
        alert("Sent successfully!");
    } catch(e) { alert("Error!"); }
}
</script>
</body>
</html>
