<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>APX ULTRA V25 - Colorful Loading</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">

<style>
:root {
  --bg: #050b17;
  --panel: #0f1a2e;
  --neon: #00ffe7;
  --neon-glow: 0 0 12px #00ffe7, 0 0 24px #00ffe7, 0 0 36px #00ffe7;
  --call: #00ff88;
  --put: #ff3b6b;
  --gold: #ffd700;
}

body { margin:0; background:var(--bg); color:white; font-family:'Rajdhani'; min-height:100vh; }

header {
  text-align:center; padding:20px 15px; background:black;
  border-bottom:2px solid var(--neon); box-shadow:var(--neon-glow);
}

.logo {
  font-family:'Orbitron'; font-size:28px;
  color:var(--neon); text-shadow:0 0 20px var(--neon);
}

.container { max-width:500px; margin:20px auto; padding:10px; }

.panel {
  background:var(--panel); border-radius:18px; padding:20px;
  border:1px solid rgba(0,255,231,.2); box-shadow:0 0 25px rgba(0,255,231,.15);
}

.tabs { display:flex; gap:8px; margin-bottom:15px; }

.tab {
  flex:1; padding:10px; border:1px solid var(--neon);
  background:transparent; color:var(--neon); border-radius:10px;
  font-weight:bold; cursor:pointer; transition:all .3s;
}

.tab.active { background:var(--neon); color:black; box-shadow:var(--neon-glow); }

select, input[type="time"] {
  width:100%; padding:12px; margin-bottom:12px;
  background:#0a1326; border:1px solid #223654; border-radius:10px; color:white;
}

button {
  width:100%; padding:14px; margin-top:8px;
  border:none; border-radius:12px;
  font-family:'Orbitron'; font-weight:bold; cursor:pointer;
}

.generate { background:linear-gradient(135deg,#00ffe7,#ff00aa,#00c4ff); color:black; box-shadow:var(--neon-glow); }

.telegram { background:#0088cc; color:white; }

#output {
  margin-top:20px; background:#0a1326; padding:15px; border-radius:12px;
  border:1px dashed var(--neon); white-space:pre-wrap; font-family:monospace;
  min-height:200px; color:#d0f8ff;
}

.loader {
  text-align:center; color:var(--neon); font-family:'Orbitron'; padding:40px 0;
  animation:pulse 1.5s infinite alternate;
}

.progress-bar {
  width:80%; height:12px; background:#0f1a2e; border-radius:6px;
  margin:20px auto; overflow:hidden; box-shadow:0 0 15px rgba(0,255,231,0.3);
}

.progress-fill {
  width:0%; height:100%;
  background:linear-gradient(90deg, #00ffe7, #ff00aa, #00c4ff, #ff3b6b);
  background-size: 300% 100%;
  animation:loading 3.5s linear forwards, gradientMove 4s linear infinite;
}

@keyframes loading { 0% {width:0%} 100% {width:100%} }
@keyframes gradientMove { 0% {background-position:0% 50%} 100% {background-position:300% 50%} }
@keyframes pulse { from{opacity:.4} to{opacity:1} }
</style>
</head>

<body>

<header>
<div class="logo">APX ULTRA V25</div>
</header>

<div class="container">
<div class="panel">

<div class="tabs">
<button class="tab active" onclick="setMarket('OTC',this)">OTC</button>
<button class="tab" onclick="setMarket('STOCK',this)">STOCK</button>
<button class="tab" onclick="setMarket('CRYPTO',this)">CRYPTO</button>
</div>

<select id="pairs" multiple></select>

<div style="display:flex;gap:10px">
<input type="time" id="start" value="14:00">
<input type="time" id="end" value="15:30">
</div>

<button class="generate" onclick="generate()">GENERATE HIGH QUALITY</button>
<button class="telegram" onclick="sendTG()">SEND TELEGRAM</button>

<div id="output">READY...</div>

</div>
</div>

<script>

const API = "https://apx.mkapi009.workers.dev?pair=";
const TG = "https://signal.mkapi009.workers.dev/send";

let FINAL = [];
let LOCK = false;

const LIST = {
  OTC: ["USDPKR-otc","USDBDT-otc","USDINR-otc","USDARS-otc","USDNGN-otc","BRLUSD-otc","USDMXN-otc","USDEGP-otc","USDIDR-otc"],
  STOCK: ["MSFSTK-otc","AXPSTK-OTC","PFESTK-otc","MCDSTK-otc","JNJSTK-otc","FABSTK-otc","BOISTK-otc"],
  CRYPTO: ["XAUUSD-otc","BTCUSD-otc"]
};

function setMarket(type,btn){
  document.querySelectorAll(".tab").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  pairs.innerHTML = "";
  LIST[type].forEach(p=>{
    let o = document.createElement("option");
    o.value = p;
    o.textContent = p.replace(/-otc|-OTC/,'');
    pairs.appendChild(o);
  });
}
setMarket("OTC", document.querySelector(".tab.active"));

// High accuracy logic (balanced)
function analyze(c) {
  if (c.length < 60) return null;

  let recent = c.slice(-60);
  let ema20 = EMA(recent, 20);
  let ema50 = EMA(recent, 50);
  if (!ema20 || !ema50) return null;

  let trend = ema20 > ema50 ? 1 : -1;

  let momentum = 0;
  let weight = 1;
  for (let i = 1; i < recent.length; i++) {
    let d = recent[i].close - recent[i-1].close;
    momentum += d > 0 ? weight : (d < 0 ? -weight : 0);
    weight += 0.02;
  }

  let last = recent[recent.length - 1];
  let high = Math.max(...recent.slice(-12).map(x => x.high));
  let low = Math.min(...recent.slice(-12).map(x => x.low));

  let breakout = 0;
  if (last.close > high) breakout = 2;
  if (last.close < low) breakout = -2;

  let body = Math.abs(last.close - last.open);
  let range = last.high - last.low || 0.0001;
  let strength = body / range;

  let score = trend * 3 + momentum * 0.08 + breakout + (strength > 0.6 ? 2 : 0);

  if (score >= 4) return "CALL";
  if (score <= -4) return "PUT";

  return last.close > last.open ? "CALL" : "PUT";
}

function EMA(data, period) {
  if (data.length < period) return null;
  let k = 2 / (period + 1);
  let ema = data[data.length - period].close;
  for (let i = data.length - period + 1; i < data.length; i++) {
    ema = data[i].close * k + ema * (1 - k);
  }
  return ema;
}

async function generate() {
  if (LOCK) return alert("Already Generated. Refresh to rescan.");
  LOCK = true;
  FINAL = [];

  const output = document.getElementById('output');
  output.innerHTML = `
    <div class="loader">SCANNING HIGH ACCURACY...</div>
    <div class="progress-bar">
      <div class="progress-fill"></div>
    </div>
  `;

  const selected = [...pairs.selectedOptions].map(o => o.value);
  if (!selected.length) {
    output.innerText = "Select pairs!";
    LOCK = false;
    return;
  }

  let pool = [];
  for (const p of selected) {
    try {
      let r = await fetch(API + p);
      let j = await r.json();
      let candles = j?.data || [];
      let dir = analyze(candles);
      if (dir) pool.push({pair: p.replace(/-otc|-OTC/,''), dir});
    } catch {}
  }

  if (!pool.length) {
    output.innerText = "No High Quality Setup Found.";
    return;
  }

  distribute(pool);
  display();
}

function distribute(pool) {
  const s = start.value, e = end.value;
  let now = new Date();
  let startMs = new Date(now.toDateString() + " " + s).getTime();
  let endMs = new Date(now.toDateString() + " " + e).getTime();
  if (endMs <= startMs) endMs += 86400000;

  const totalSignals = 15;
  const baseGap = (endMs - startMs) / totalSignals;
  let current = startMs;

  pool.sort(() => Math.random() - 0.5);

  let pairUsage = {};

  for (let i = 0; i < totalSignals; i++) {
    let randomGap = baseGap * (0.8 + Math.random() * 0.6);
    current += randomGap;

    if (current >= endMs) break;

    let obj = pool[i % pool.length];
    pairUsage[obj.pair] = (pairUsage[obj.pair] || 0) + 1;

    if (pairUsage[obj.pair] > 5) continue;

    FINAL.push({
      time: new Date(current).toTimeString().slice(0,5),
      pair: obj.pair,
      dir: obj.dir
    });
  }
}

function display() {
  let txt = "APX ULTRA HIGH QUALITY\n";
  txt += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
  txt += "UTC+6 | 1 Min Expiry\n";
  txt += "Logic: EMA + Momentum + Breakout\n\n";

  FINAL.forEach(s => {
    txt += `‚û§ ${s.pair.padEnd(12)} ${s.time}   ${s.dir}\n`;
  });

  txt += "\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
  txt += "‚Ä¢ Trade exact time\n‚Ä¢ 1 Step Martingale\n‚Ä¢ Avoid News\n‚Ä¢ Stop after 2 losses\n";
  document.getElementById('output').innerText = txt;
}

async function sendTG() {
  if (!FINAL.length) return alert("Generate first!");

  const steps = [
    ["[‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 35%]", "üì° Connecting Server"],
    ["[‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë 70%]", "üß¨ Scanning Patterns"],
    ["[‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì 100%]", "‚úÖ Result Ready"]
  ];

  try {
    // Step 1
    await fetch(TG, {method:"POST", body: `‚ú¶‚ïê‚ï° APX ULTRA SIGNALS ‚ïû‚ïê‚ú¶\n\nScanning...\n\( {steps[0][0]}\n \){steps[0][1]}`});
    await new Promise(r => setTimeout(r, 20000)); // 20 sec

    // Step 2
    await fetch(TG, {method:"POST", body: `‚ú¶‚ïê‚ï° APX ULTRA SIGNALS ‚ïû‚ïê‚ú¶\n\n\( {steps[1][0]}\n \){steps[1][1]}`});
    await new Promise(r => setTimeout(r, 20000)); // 20 sec

    // Step 3 + real signals
    setTimeout(async () => {
      let msg = "‚ú¶‚ïê‚ï° APX ULTRA SIGNALS ‚ïû‚ïê‚ú¶\n\n";
      msg += "UTC+6 Timezone | 1 Min Expiry\n";
      msg += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";

      FINAL.forEach(s => {
        msg += `‚ú¶ ${s.time} | ${s.pair.padEnd(8)} | ${s.dir}\n`;
      });

      msg += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n";
      msg += "TRADING RULES\n";
      msg += "‚Ä¢ Trade exact time\n";
      msg += "‚Ä¢ 1 Step Martingale\n";
      msg += "‚Ä¢ Avoid News\n";
      msg += "‚Ä¢ Stop after 2 losses\n\n";
      msg += "Powered by ‚ú¥Ô∏è APX Premium";

      await fetch(TG, {method:"POST", body:msg});
      alert("High Accuracy Signals Sent!");
    }, 20000); // last 20 sec ‚Üí total \~60 sec
  } catch (e) {
    alert("Telegram send failed. Check console.");
    console.error(e);
  }
}

</script>
</body>
</html>
