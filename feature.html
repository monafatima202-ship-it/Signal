<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>APX NEURAL BRAIN V8 - PRO QUANT</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">

<style>
:root { --bg: #01060b; --panel: #0a111f; --neon: #00ff88; --glow: 0 0 15px #00ff88; --text: #e0fbee; }
body { margin:0; background:var(--bg); color:var(--text); font-family:'Rajdhani'; overflow-x:hidden; }
header { text-align:center; padding:20px; background:black; border-bottom:3px solid var(--neon); box-shadow:var(--glow); }
.logo { font-family:'Orbitron'; font-size:24px; color:var(--neon); text-shadow:0 0 10px var(--neon); letter-spacing:2px; }
.container { max-width:450px; margin:15px auto; padding:10px; }
.panel { background:var(--panel); border-radius:20px; padding:25px; border:1px solid rgba(0,255,136,.2); box-shadow:0 0 40px rgba(0,0,0,0.5); }
.tabs { display:flex; gap:8px; margin-bottom:15px; }
.tab { flex:1; padding:10px; border:1.5px solid var(--neon); background:transparent; color:var(--neon); border-radius:8px; font-weight:bold; cursor:pointer; font-family:'Orbitron'; font-size:10px; transition:0.3s; }
.tab.active { background:var(--neon); color:black; box-shadow:var(--glow); }
select { width:100%; padding:12px; margin-bottom:15px; background:#050d1a; border:1px solid #1a3a3a; border-radius:10px; color:white; font-size:14px; outline:none; }
.time-row { display:flex; justify-content:space-between; gap:10px; margin-bottom:15px; }
input, select { background:#050d1a !important; border:1px solid #1a3a3a !important; color:white !important; border-radius:10px; padding:10px; }
button { width:100%; padding:16px; margin-top:10px; border:none; border-radius:12px; font-family:'Orbitron'; font-weight:900; cursor:pointer; text-transform:uppercase; font-size:13px; transition:0.3s; }
.generate { background:linear-gradient(135deg,#00ff88,#00ccff); color:black; box-shadow:var(--glow); }
.telegram { background:#0088cc; color:white; }
#output { margin-top:20px; background:#01040a; padding:15px; border-radius:12px; border:1px dashed var(--neon); white-space:pre-wrap; font-family:monospace; font-size:12px; color:#afffdf; line-height:1.6; min-height:180px; }
.loader-box { padding:20px; text-align:center; }
.bar-bg { width:100%; background:#0d1e13; height:8px; border-radius:10px; margin:10px 0; }
.bar-fill { width:0%; height:100%; background:var(--neon); box-shadow:var(--glow); transition:0.3s; }
</style>
</head>
<body>

<header><div class="logo">APX BRAIN V8 QUANT</div></header>

<div class="container">
  <div class="panel">
    <div class="tabs">
      <button class="tab active" onclick="setMarket('OTC',this)">OTC</button>
      <button class="tab" onclick="setMarket('STOCK',this)">STOCKS</button>
      <button class="tab" onclick="setMarket('CRYPTO',this)">CRYPTO</button>
    </div>

    <label style="font-size:11px; color:var(--neon)">ASSET ANALYSIS:</label>
    <select id="pairs" multiple size="5"></select>

    <div class="time-row">
      <div><small>START</small><input type="time" id="start" value="10:00"></div>
      <div><small>TIMEZONE</small>
        <select id="tz">
          <option value="5">UTC +5 (PK)</option>
          <option value="6">UTC +6 (BD)</option>
        </select>
      </div>
    </div>

    <button class="generate" onclick="calculateNeuralSignals()">DEEP BRAIN SCAN </button>
    <button class="telegram" onclick="sendToTG()">SEND TO TELEGRAM</button>

    <div id="output">BRAIN STATUS: WAITING FOR INPUT...</div>
  </div>
</div>

<script>
const API_URL = "https://apx.mkapi009.workers.dev?pair=";
const TG_WORKER = "https://signal.mkapi009.workers.dev/send";

let FINAL_LIST = [];
let IS_SCANNING = false;

const ASSETS = {
  OTC: ["USDPKR-otc","USDBDT-otc","USDINR-otc","USDARS-otc","USDNGN-otc","BRLUSD-otc","USDMXN-otc","USDEGP-otc","USDIDR-otc"],
  STOCK: ["MSFSTK-otc","AXPSTK-OTC","PFESTK-otc","MCDSTK-otc","JNJSTK-otc"],
  CRYPTO: ["XAUUSD-otc","BTCUSD-otc","ETHUSD-otc"]
};

function setMarket(type, btn) {
  document.querySelectorAll(".tab").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
  const select = document.getElementById('pairs');
  select.innerHTML = "";
  ASSETS[type].forEach(p => {
    let opt = document.createElement("option");
    opt.value = p;
    opt.textContent = p.replace(/-otc|-OTC/gi, '').toUpperCase();
    select.appendChild(opt);
  });
}
setMarket("OTC", document.querySelector(".tab.active"));

// --- BRAIN ENGINE: TECHNICAL ANALYSIS ---
function getSignalLogic(candles) {
    if (candles.length < 30) return null;
    
    let last = candles[candles.length - 1];
    let closePrice = last.close;
    
    // 1. EMA 14 Trend
    let ema14 = candles.slice(-14).reduce((a, b) => a + b.close, 0) / 14;
    
    // 2. Simple RSI Simulation (Momentum)
    let upMoves = 0, downMoves = 0;
    for(let i = candles.length - 14; i < candles.length; i++) {
        let diff = candles[i].close - candles[i-1].close;
        if(diff > 0) upMoves += diff; else downMoves -= diff;
    }
    let rs = upMoves / (downMoves || 1);
    let rsi = 100 - (100 / (1 + rs));

    let score = 0;
    let direction = "";

    // Neural Decision
    if (closePrice > ema14 && rsi < 65) { score = 85 + (rsi/10); direction = "CALL ↑"; }
    else if (closePrice < ema14 && rsi > 35) { score = 85 + ((100-rsi)/10); direction = "PUT ↓"; }
    else { direction = Math.random() > 0.5 ? "CALL ↑" : "PUT ↓"; score = 91.2; }

    return { dir: direction, acc: Math.min(98.9, score).toFixed(1) };
}

async function calculateNeuralSignals() {
  if (IS_SCANNING) return;
  const selected = [...document.getElementById('pairs').selectedOptions].map(o => o.value);
  if (selected.length < 3) return alert("Hamesha 3 se zyada pairs select karein diversity ke liye!");

  IS_SCANNING = true;
  FINAL_LIST = [];
  const out = document.getElementById('output');
  out.innerHTML = `<div class="loader-box">NEURAL BRAIN SCANNING CANDLES...<div class="bar-bg"><div class="bar-fill" id="pb"></div></div></div>`;

  let analyzedPairs = [];

  for (let i = 0; i < selected.length; i++) {
    try {
      let res = await fetch(API_URL + selected[i]);
      let json = await res.json();
      let analysis = getSignalLogic(json.data || []);
      if (analysis) {
        analyzedPairs.push({ name: selected[i].split('-')[0].toUpperCase(), ...analysis });
      }
      document.getElementById('pb').style.width = ((i + 1) / selected.length) * 100 + "%";
    } catch (e) { console.error("Error"); }
  }

  // --- TIME & SHUFFLE LOGIC (TO BREAK SEQUENCE) ---
  const tz = parseInt(document.getElementById('tz').value);
  const startInput = document.getElementById('start').value;
  let currentTs = new Date("2026-01-01 " + startInput).getTime();

  // Shuffle analyzed pairs so they don't appear in order
  analyzedPairs.sort(() => Math.random() - 0.5);

  for (let j = 0; j < 10; j++) {
    currentTs += (7 + Math.random() * 10) * 60000;
    let data = analyzedPairs[j % analyzedPairs.length];
    
    FINAL_LIST.push({
      time: new Date(currentTs).toTimeString().slice(0, 5),
      ...data
    });
  }

  // Sort by time finally
  FINAL_LIST.sort((a, b) => a.time.localeCompare(b.time));

  renderUI(tz);
  IS_SCANNING = false;
}

function renderUI(tz) {
  let h = "✅ APX NEURAL QUANT V8 ✅\n";
  h += "━━━━━━━━━━━━━━━━━━━━━━\n";
  h += `ZONE: UTC +${tz} | 1 MIN EXP\n`;
  h += "BRAIN: EMA-RSI CONFLUENCE\n\n";
  
  FINAL_LIST.forEach(s => {
    h += `✦ ${s.time} | ${s.name.padEnd(8)} | ${s.dir} [${s.acc}%]\n`;
  });
  
  h += "\n━━━━━━━━━━━━━━━━━━━━━━\n";
  h += "STRATEGY: 1-STEP MARTINGALE\n";
  h += "STATUS: MARKET ANALYZED ✅";
  document.getElementById('output').innerText = h;
}

async function sendToTG() {
  if (FINAL_LIST.length === 0) return alert("Pehle Scan Karein!");
  try {
    await fetch(TG_WORKER, { method: "POST", body: document.getElementById('output').innerText });
    alert("Sent Successfully!");
  } catch (e) { alert("Worker Error!"); }
}
</script>
</body>
</html>
