<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>APX ULTRA V23 REAL</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">

<style>
:root {
  --bg:#050b17;
  --panel:#0f1a2e;
  --neon:#00ffe7;
  --call:#00ff88;
  --put:#ff3b6b;
  --text:#e0faff;
}
body{margin:0;background:var(--bg);color:var(--text);font-family:'Rajdhani'}
header{text-align:center;padding:20px;background:#000;border-bottom:2px solid var(--neon);box-shadow:0 0 20px var(--neon)}
.logo{font-family:'Orbitron';font-size:2rem;color:var(--neon);text-shadow:0 0 15px var(--neon)}
.container{max-width:520px;margin:20px auto;padding:0 12px}
.panel{background:var(--panel);padding:22px;border-radius:18px;border:1px solid rgba(0,255,231,.2)}
.tabs{display:flex;gap:8px;margin-bottom:15px}
.tab{flex:1;padding:10px;border:1px solid var(--neon);background:transparent;color:var(--neon);cursor:pointer;border-radius:8px}
.tab.active{background:var(--neon);color:#000}
select,input{width:100%;padding:12px;margin-bottom:12px;background:#0a1326;border:1px solid #2a3f5a;color:white;border-radius:8px}
button{width:100%;padding:14px;border:none;border-radius:10px;font-family:'Orbitron';font-weight:bold;margin-top:8px;cursor:pointer}
.generate{background:var(--neon);color:#000}
.telegram{background:#0088cc;color:white}
#output{margin-top:18px;padding:16px;background:#0a1326;border:1px dashed var(--neon);border-radius:10px;white-space:pre-wrap;font-family:monospace;font-size:13px}
.loader{text-align:center;color:var(--neon);font-family:'Orbitron'}
</style>
</head>
<body>

<header>
<div class="logo">APX ULTRA REAL ENGINE</div>
</header>

<div class="container">
<div class="panel">

<div class="tabs">
<button class="tab active" onclick="setMarket('OTC',this)">OTC</button>
<button class="tab" onclick="setMarket('STOCK',this)">STOCK</button>
<button class="tab" onclick="setMarket('CRYPTO',this)">CRYPTO</button>
</div>

<select id="pairs" multiple></select>

<div style="display:flex;gap:8px">
<input type="time" id="start" value="14:00">
<input type="time" id="end" value="15:00">
</div>

<button class="generate" onclick="generate()">GENERATE REAL SETUPS</button>
<button class="telegram" onclick="sendTG()">SEND TELEGRAM</button>

<div id="output">READY...</div>

</div>
</div>

<script>

const API="https://apx.mkapi009.workers.dev?pair=";
const TG="https://signal.mkapi009.workers.dev/send";

let FINAL=[];

const LIST={
OTC:["USDPKR-otc","USDBDT-otc","USDINR-otc","USDARS-otc","USDNGN-otc","BRLUSD-otc","USDMXN-otc","USDEGP-otc","USDIDR-otc"],
STOCK:["MSFSTK-otc","AXPSTK-OTC","PFESTK-otc","MCDSTK-otc","JNJSTK-otc","FABSTK-otc","BOISTK-otc"],
CRYPTO:["XAUUSD-otc","BTCUSD-otc"]
};

function setMarket(type,btn){
document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
btn.classList.add("active");
pairs.innerHTML="";
LIST[type].forEach(p=>{
let o=document.createElement("option");
o.value=p;o.textContent=p.replace(/-otc|-OTC/,'');
pairs.appendChild(o);
});
}
setMarket("OTC",document.querySelector(".tab.active"));

function EMA(data,period){
let k=2/(period+1);
let ema=data[0].close;
for(let i=1;i<data.length;i++){
ema=data[i].close*k+ema*(1-k);
}
return ema;
}

function analyzeAll(candles,pair){
let signals=[];
for(let i=60;i<candles.length-2;i++){

let slice=candles.slice(i-60,i);
let ema20=EMA(slice.slice(-20),20);
let ema50=EMA(slice.slice(-50),50);

let score=0;

if(ema20>ema50)score+=2;
else score-=2;

let momentum=0;
for(let j=1;j<6;j++){
if(slice[slice.length-j].close>slice[slice.length-j-1].close)momentum++;
else momentum--;
}
score+=momentum*0.5;

let last=slice[slice.length-1];
let body=Math.abs(last.close-last.open);
let range=last.high-last.low||0.0001;
if(body/range>0.45)score+=1;

let highs=Math.max(...slice.slice(-10).map(x=>x.high));
let lows=Math.min(...slice.slice(-10).map(x=>x.low));
if(last.close>highs)score+=2;
if(last.close<lows)score-=2;

if(score>=4){
signals.push({pair:pair,time:last.time,dir:"CALL"});
}
if(score<=-4){
signals.push({pair:pair,time:last.time,dir:"PUT"});
}
}
return signals;
}

async function generate(){
FINAL=[];
output.innerHTML="<div class='loader'>SCANNING REAL MARKET STRUCTURE...</div>";

let selected=[...pairs.selectedOptions].map(o=>o.value);
if(!selected.length){output.innerText="Select pairs";return;}

for(let pair of selected){
try{
let res=await fetch(API+pair);
let json=await res.json();
let candles=json?.data||[];
let setups=analyzeAll(candles,pair.replace(/-otc|-OTC/,''));
FINAL.push(...setups);
}catch(e){}
}

if(!FINAL.length){
output.innerText="No strong setups found.";
return;
}

FINAL.sort((a,b)=>new Date(a.time)-new Date(b.time));
display();
}

function display(){
let txt="✦═╡ APX ULTRA SIGNALS ╞═✦\n\n";
txt+="UTC+6 | 1 Min Expiry\n";
txt+="━━━━━━━━━━━━━━━━━━\n";

FINAL.forEach(s=>{
let t=new Date(s.time);
let time=t.toTimeString().slice(0,5);
txt+=`✦ ${time} | ${s.pair.padEnd(10)} | ${s.dir}\n`;
});

txt+="━━━━━━━━━━━━━━━━━━\n";
txt+="Rules:\n";
txt+="• Trade exact signal time\n";
txt+="• 1 Step Martingale\n";
txt+="• Avoid high impact news\n";
txt+="• Stop after 2 losses\n";

output.innerText=txt;
}

async function sendTG(){
if(!FINAL.length){alert("Generate first");return;}
let msg="✦═╡ APX ULTRA SIGNALS ╞═✦\n\nUTC+6 | 1 Min\n━━━━━━━━━━━━━━\n```\n";
FINAL.forEach(s=>{
let t=new Date(s.time);
msg+=`${t.toTimeString().slice(0,5)} | ${s.pair.padEnd(10)} | ${s.dir}\n`;
});
msg+="```\n━━━━━━━━━━━━━━\nAPX Premium";
await fetch(TG,{method:"POST",body:msg});
alert("Sent.");
}

</script>
</body>
</html>
