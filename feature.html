<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>APX NEURAL ENGINE V8</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
<style>
:root { --neon:#00ffcc; --bg:#010409; --call:#00ff88; --put:#ff3366; --gold:#ffcc00; }
body { margin:0; background:var(--bg); font-family:'Rajdhani'; color:white; }
header { padding:15px; text-align:center; border-bottom:2px solid var(--neon); background:black; }
.logo { font-family:'Orbitron'; color:var(--neon); font-size:20px; letter-spacing:2px; }
.container { max-width:450px; margin:20px auto; padding:15px; }
.panel { background:#0d1117; border:1px solid rgba(0,255,204,0.3); border-radius:15px; padding:20px; box-shadow: 0 5px 20px rgba(0,0,0,1); }
label { font-size: 12px; color: var(--neon); font-weight: bold; margin-bottom: 5px; display: block; }
select, input { width:100%; padding:12px; background:#020617; color:white; border:1px solid #30363d; border-radius:10px; margin-bottom:15px; box-sizing: border-box; }
.main-btn { width:100%; padding:16px; background:var(--neon); color:black; border:none; border-radius:12px; font-family:'Orbitron'; font-weight:bold; cursor:pointer; font-size:15px; }
.tg-btn { width:100%; padding:14px; background:#0088cc; color:white; border:none; border-radius:12px; cursor:pointer; font-weight: bold; margin-top: 10px; font-family: 'Orbitron'; }
#output { 
    margin-top:20px; 
    background:#05070a; 
    padding:20px; 
    border-radius:12px; 
    font-family: 'Courier New', monospace; 
    white-space: pre; 
    border: 1px solid #1a1d23;
    font-size: 13px;
    overflow-x: auto;
}
.loading { text-align:center; color:var(--neon); font-family:'Orbitron'; padding:20px; }
</style>
</head>
<body>

<header>
    <div class="logo">APX NEURAL ENGINE</div>
    <div id="clock" style="font-size:11px; color:var(--gold); margin-top:5px;">UTC+6</div>
</header>

<div class="container">
    <div class="panel">
        <label>SELECT ASSETS</label>
        <select id="pairs" multiple size="5">
            <option value="USDPKR-OTC" selected>USDPKR-OTC</option>
            <option value="USDBDT-OTC">USDBDT-OTC</option>
            <option value="USDINR-OTC">USDINR-OTC</option>
            <option value="EURUSD-OTC">EURUSD-OTC</option>
        </select>
        
        <div style="display:flex; gap:10px;">
            <div style="flex:1"><label>START TIME</label><input type="time" id="start" value="22:00"></div>
            <div style="flex:1"><label>END TIME</label><input type="time" id="end" value="23:30"></div>
        </div>

        <button class="main-btn" onclick="processSignals()">GENERATE PREMIUM SIGNALS</button>
        <button class="tg-btn" onclick="sendToTelegram()">SEND TO TELEGRAM</button>

        <div id="output">READY TO ANALYZE...</div>
    </div>
</div>

<script>
const API = "https://candle.mkapi009.workers.dev/?pair=";
const TG_WORKER = "https://signal.mkapi009.workers.dev/send";
let GLOBAL_MSG = "";

// Clock
setInterval(() => {
    let d = new Date();
    d.setHours(d.getUTCHours() + 6);
    document.getElementById('clock').innerText = "UTC+6 | " + d.toLocaleTimeString();
}, 1000);

async function processSignals() {
    const output = document.getElementById('output');
    const selected = [...document.getElementById('pairs').selectedOptions].map(o => o.value);
    const sVal = document.getElementById('start').value;
    const eVal = document.getElementById('end').value;

    if (selected.length === 0) return alert("Please select pairs!");
    output.innerHTML = `<div class="loading">SCANNING CANDLES & TRENDS...</div>`;

    let now = new Date();
    let sTime = new Date(now.toDateString() + " " + sVal).getTime();
    let eTime = new Date(now.toDateString() + " " + eVal).getTime();
    if(eTime <= sTime) eTime += 86400000;

    let signals = [];

    for (let asset of selected) {
        let dir = "CALL";
        try {
            const res = await fetch(API + asset + "&count=100");
            const data = await res.json();
            if(data?.candles) {
                // Analysis: Stronger Trend Following
                let lastCandles = data.candles.slice(-20);
                let greenBody = 0, redBody = 0;
                lastCandles.forEach(c => {
                    if(c.close > c.open) greenBody += (c.close - c.open);
                    else redBody += (c.open - c.close);
                });
                dir = greenBody > redBody ? "CALL" : "PUT";
            }
        } catch(e) { dir = (asset.charCodeAt(0) % 2 === 0) ? "CALL" : "PUT"; }

        // Fixed Distribution to avoid randomness on double click
        let step = (eTime - sTime) / 6;
        for(let i=1; i<=5; i++) {
            let t = new Date(sTime + (step * i));
            t.setSeconds(0);
            signals.push({ pair: asset, time: t.toTimeString().slice(0, 5), dir: dir, raw: t.getTime() });
        }
    }

    signals.sort((a,b) => a.raw - b.raw);

    let header = `UTC+6 Timezone\nExpiry: 1 Minute\nMoney Management: 1 Step MTG\n\n`;
    let list = "";
    signals.forEach(s => {
        let color = s.dir === "CALL" ? "#00ff88" : "#ff3366";
        list += `â—‡ ${s.pair.padEnd(11)} | ${s.time} | <span style="color:${color}; font-weight:bold;">${s.dir}</span>\n`;
    });
    let footer = `\nTRADING RULES\nTrade only at signal time\nUse 1 Step Martingale\nAvoid high impact news\nStop after 2 losses\n\nPowered by APX Elite Premium`;

    GLOBAL_MSG = header + list.replace(/<[^>]*>/g, '') + footer; // Clean text for TG
    output.innerHTML = header + list + footer;
}

async function sendToTelegram() {
    if(!GLOBAL_MSG) return alert("Generate signals first!");
    try {
        await fetch(TG_WORKER, { method: "POST", body: GLOBAL_MSG });
        alert("Signals sent to Telegram!");
    } catch(e) { alert("Error sending to Telegram."); }
}
</script>
</body>
</html>
