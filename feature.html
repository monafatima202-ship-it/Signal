<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>APX ULTRA FINAL</title>

<style>
body{
background:#041622;
color:white;
font-family:Arial;
text-align:center;
padding:20px;
}

h2{ color:#00ffc3; }

.card{
background:#082033;
padding:20px;
border-radius:15px;
max-width:460px;
margin:auto;
}

select,input,button{
width:95%;
padding:12px;
margin:8px;
border-radius:8px;
border:none;
font-size:15px;
}

select,input{
background:#041622;
color:#00ffc3;
border:1px solid #00ffc3;
}

button{
background:#00ffc3;
color:#002b24;
font-weight:bold;
cursor:pointer;
}

#out{
margin-top:20px;
background:#021018;
padding:15px;
border-radius:10px;
white-space:pre-line;
text-align:left;
}
</style>
</head>

<body>

<h2>üî• APX ULTRA FINAL üî•</h2>
<p>UTC+6 Premium Candle Engine</p>

<div class="card">

<select id="category"></select>
<select id="pairs" multiple size="8"></select>

<button onclick="selectAll()">Select All Pairs</button>

<input type="time" id="start" value="01:00">
<input type="time" id="end" value="05:00">

<button onclick="generate()">Generate Signals</button>
<button onclick="sendTG()">Send Telegram</button>

<div id="out">Waiting...</div>

</div>

<script>

const API="https://candle.mkapi009.workers.dev";
const TG="https://signal.mkapi009.workers.dev/send";

const DATA={
OTC:["USDPKR-OTC","USDINR-OTC","USDBRL-OTC","USDMXN-OTC","USDBDT-OTC","USDARS-OTC","USDEGP-OTC"],
CRYPTO:["ETHUSD-OTC","BNBUSD-OTC"],
STOCK:["MSFT","INTC","PFE","AXP"]
};

let SIGNALS=[];
let lastDir={};

// ===== LOAD CATEGORY =====
const cat=document.getElementById("category");
Object.keys(DATA).forEach(k=>{
let o=document.createElement("option");
o.value=k;
o.text=k;
cat.add(o);
});

// ===== LOAD PAIRS =====
function loadPairs(){
pairs.innerHTML="";
DATA[cat.value].forEach(p=>{
let o=document.createElement("option");
o.text=p;
pairs.add(o);
});
}
cat.onchange=loadPairs;
loadPairs();

// ===== SELECT ALL =====
function selectAll(){
for(let o of pairs.options) o.selected=true;
}

// ===== GET SELECTED =====
function selectedPairs(){
return [...pairs.selectedOptions].map(o=>o.text);
}

// ===== GET CANDLES =====
async function getCandles(pair){
try{
let r=await fetch(API+`/?pair=${pair}&count=30`);
let j=await r.json();
if(!j.candles) return null;
return j.candles.reverse();
}catch{
return null;
}
}

// ===== API TREND =====
function dirFromCandles(c,pair){

let last=c.slice(-4);
let up=0,down=0;

for(let i=1;i<last.length;i++){
if(last[i].close>last[i-1].close) up++;
if(last[i].close<last[i-1].close) down++;
}

let dir=up>=down?"CALL":"PUT";
lastDir[pair]=dir;
return dir;
}

function safeDir(pair){
return lastDir[pair] || "CALL";
}

// ===== RANDOM TIME =====
function randTime(s,e){
let a=new Date("2020-01-01 "+s);
let b=new Date("2020-01-01 "+e);
let t=new Date(a.getTime()+Math.random()*(b-a));
return t.toTimeString().slice(0,5);
}

// ===== GENERATE =====
async function generate(){

SIGNALS=[];
out.innerText="Generating Ultra Signals...";

let list=selectedPairs();
if(list.length===0){
out.innerText="Select Pairs First";
return;
}

let s=start.value;
let e=end.value;

let callCount=0;
let putCount=0;

while(SIGNALS.length<20){

let p=list[Math.floor(Math.random()*list.length)];

let c=await getCandles(p);
let dir=c?dirFromCandles(c,p):safeDir(p);

// ===== BALANCE ENGINE =====
if(callCount > putCount+3) dir="PUT";
if(putCount > callCount+3) dir="CALL";

if(dir==="CALL") callCount++;
else putCount++;

SIGNALS.push({
pair:p.replace("-OTC",""),
time:randTime(s,e),
dir:dir
});

}

// ===== SORT BY TIME =====
SIGNALS.sort((a,b)=>a.time.localeCompare(b.time));

show();
}

// ===== SHOW =====
function show(){

let rows=SIGNALS.map(s=>{
return `‚ßâ ${s.pair}  ${s.time} ‚û£ ${s.dir}`;
});

out.innerText=
`üî• APX ULTRA FINAL üî•

${rows.join("\n")}

UTC+6 | Expiry M1 | 1 Step MTG`;
}

// ===== TELEGRAM FORMAT =====
function telegramText(){

let rows=SIGNALS.map(s=>{
return `‚ßâ ${s.pair}  ${s.time} ‚û£ ${s.dir}`;
});

return `
üî• APX ULTRA PREMIUM üî•

${rows.join("\n")}

====================
UTC+6 Timezone
Expiry: 1 Minute
Money Management: 1 Step MTG
====================

TRADING RULES
1Ô∏è‚É£ Trade only at signal time
2Ô∏è‚É£ Use 1 Step Martingale only
3Ô∏è‚É£ Avoid high impact news
4Ô∏è‚É£ Stop after 2 losses
5Ô∏è‚É£ Trade with trend direction

üëë Powered by APX Elite Premium
`;
}

// ===== SEND TELEGRAM =====
async function sendTG(){

if(SIGNALS.length==0){
alert("Generate First");
return;
}

await fetch(TG,{
method:"POST",
body:telegramText()
});

alert("Sent To Telegram");
}

</script>

</body>
</html>
