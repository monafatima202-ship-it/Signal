<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>APX ULTRA PREMIUM</title>

<style>
body {background:#0d1117;color:white;font-family:sans-serif;text-align:center;padding:20px}
button{padding:12px 20px;margin:10px;font-weight:bold;background:#00ffcc;border:none;border-radius:6px}
select,input{padding:8px;margin:8px}
.sig{margin:6px;padding:8px;border-bottom:1px solid #333}
.call{color:#00ff88;font-weight:bold}
.put{color:#ff3366;font-weight:bold}
.loading{color:#00ffcc;font-weight:bold}
</style>
</head>

<body>

<h2>APX SMART ENGINE</h2>

<select id="pairs" multiple size="8">
<option value="USDINR-otc">USDINR-otc</option>
<option value="USDPKR-otc">USDPKR-otc</option>
<option value="USDBDT-otc">USDBDT-otc</option>
<option value="USDZAR-otc">USDZAR-otc</option>
<option value="USDNGN-otc">USDNGN-otc</option>
<option value="USDARS-otc">USDARS-otc</option>
<option value="BTCUSD-otc">BTCUSD-otc</option>
<option value="ETHUSD-otc">ETHUSD-otc</option>
<option value="MSFSTK-OTC">MSFSTK-OTC</option>
<option value="AXPSTK-OTC">AXPSTK-OTC</option>
</select>

<br>
<input type="time" id="start" value="20:00">
<input type="time" id="end" value="23:59">

<br>
<button onclick="startEngine()">GENERATE SIGNALS</button>

<div id="output"></div>

<script>

function buildAPI(pair){
  return `https://milongazi197.serv00.net/otc.php?pair=${pair}&tf=M1&limit=200`;
}

const TARGET = 10;
let SIGNALS = [];

async function startEngine(){

  SIGNALS = [];
  const selected = [...document.getElementById("pairs").selectedOptions].map(o=>o.value);
  const output = document.getElementById("output");

  if(!selected.length){
    alert("Pair select karo!");
    return;
  }

  output.innerHTML = "<div class='loading'>Scanning market...</div>";

  for(let pair of selected){

    try{
      const res = await fetch(buildAPI(pair));
      const json = await res.json();

      const candles =
        json?.data ||
        json?.candles?.data ||
        [];

      if(candles.length < 20) continue;

      const direction = analyzeSmart(candles);
      distribute(pair, direction);

    }catch(e){
      console.log("API error", e);
    }
  }

  SIGNALS.sort((a,b)=>a.raw-b.raw);
  displaySignals();
}

function analyzeSmart(c){

  let score = 0;
  const recent = c.slice(0,25);

  for(let i=0;i<recent.length;i++){
    const body = Math.abs(recent[i].close - recent[i].open);
    const range = recent[i].high - recent[i].low;
    if(range === 0) continue;

    const strength = body/range;

    if(recent[i].close > recent[i].open){
      score += strength;
    }else{
      score -= strength;
    }
  }

  if(score > 1) return "CALL";
  if(score < -1) return "PUT";

  return recent[0].close > recent[0].open ? "CALL" : "PUT";
}

function distribute(pair, dir){

  const start = document.getElementById("start").value;
  const end = document.getElementById("end").value;

  let now = new Date();
  let [sH,sM] = start.split(":").map(Number);
  let [eH,eM] = end.split(":").map(Number);

  let sD = new Date(now);
  sD.setHours(sH,sM,0,0);

  let eD = new Date(now);
  eD.setHours(eH,eM,0,0);

  if(eD <= sD) eD.setDate(eD.getDate()+1);

  let gap = (eD - sD)/TARGET;

  for(let i=0;i<TARGET;i++){
    let t = new Date(sD.getTime() + gap*i);
    SIGNALS.push({
      pair: pair,
      time: t.toTimeString().slice(0,5),
      raw: t.getTime(),
      dir: dir
    });
  }
}

function displaySignals(){

  const output = document.getElementById("output");
  output.innerHTML = "";

  if(!SIGNALS.length){
    output.innerHTML = "No signals generated.";
    return;
  }

  SIGNALS.forEach(s=>{
    output.innerHTML += `
    <div class="sig">
      ${s.time} | ${s.pair} |
      <span class="${s.dir==='CALL'?'call':'put'}">${s.dir}</span>
    </div>`;
  });
}

</script>

</body>
</html>
