<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>APX HYBRID ENGINE FINAL</title>

<style>
body{background:#0b0f14;color:white;font-family:Arial;padding:20px}
button{padding:12px 20px;margin:10px 0;background:#00ffcc;border:0;font-weight:bold;cursor:pointer}
select{width:100%;padding:10px;margin:10px 0;background:#111;color:white}
#output{margin-top:20px;border:1px solid #00ffcc;padding:15px}
.CALL{color:#00ff88;font-weight:bold}
.PUT{color:#ff3366;font-weight:bold}
.loading{color:#00ffcc}
</style>
</head>
<body>

<h2>APX HYBRID ENGINE</h2>

<select id="pair">
<option value="USDINR-otc">USDINR</option>
<option value="USDPKR-otc">USDPKR</option>
<option value="USDBDT-otc">USDBDT</option>
<option value="USDZAR-otc">USDZAR</option>
<option value="BTCUSD-otc">BTCUSD</option>
</select>

<button onclick="generate()">GENERATE SIGNAL</button>

<div id="output">Ready...</div>

<script>

const API_BASE = "https://otcapi.mkapi009.workers.dev/?pair=";

async function generate(){

output.innerHTML = "<div class='loading'>Reading candles...</div>";

let pair = document.getElementById("pair").value;

try{

let res = await fetch(API_BASE + pair + "&tf=M1&limit=500");
let data = await res.json();

let candles = data?.candles?.data;

if(!candles || candles.length < 50){
output.innerHTML = "Not enough candle data.";
return;
}

let signal = analyze(candles);

if(!signal){
output.innerHTML = "Market unclear. Wait next setup.";
return;
}

output.innerHTML = `
<div>
PAIR: ${pair}<br><br>
DIRECTION: <span class="${signal}">${signal}</span><br><br>
Logic: Trend + Momentum + Pullback + Breakout
</div>
`;

}catch(e){
output.innerHTML = "API Fetch Failed";
}

}



function analyze(c){

c = c.slice().reverse();

let recent = c.slice(-20);

// Trend Count
let up=0,down=0;
for(let i=1;i<recent.length;i++){
if(recent[i].close > recent[i-1].close) up++;
if(recent[i].close < recent[i-1].close) down++;
}

// Momentum
let last = recent[recent.length-1];
let body = Math.abs(last.close-last.open);
let range = last.high-last.low;
let strength = range>0 ? body/range : 0;

// Pullback check
let prev1 = recent[recent.length-2];
let prev2 = recent[recent.length-3];

let pullbackUp = prev1.close < prev2.close && last.close > prev1.close;
let pullbackDown = prev1.close > prev2.close && last.close < prev1.close;

// Breakout check
let highs = recent.map(x=>x.high);
let lows = recent.map(x=>x.low);
let maxHigh = Math.max(...highs.slice(0,-1));
let minLow = Math.min(...lows.slice(0,-1));

// Decision Brain

if(up>down && strength>0.2)
return "CALL";

if(down>up && strength>0.2)
return "PUT";

if(pullbackUp)
return "CALL";

if(pullbackDown)
return "PUT";

if(last.close > maxHigh)
return "CALL";

if(last.close < minLow)
return "PUT";

// Soft bias fallback (NOT random)
return up>=down ? "CALL" : "PUT";

}

</script>
</body>
</html>
